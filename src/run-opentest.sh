#!/usr/bin/env sh

cd server && opentest server &> "${LOGDIR}/opentest-server.log" &
cd ${WORKSPACE}
echo "Waiting server startup..." && sleep 10 &
cd actor-api && opentest actor &> "${LOGDIR}/opentest-actor.log" &
cd ${WORKSPACE}
echo "Waiting actor-api startup..." && sleep 10 &

if [[ "${DEBUG}" == "0" ]];
then
  opentest session create --template "${TESTENV}" --wait --out "${TESTREPORT}" &> "${LOGDIR}/opentest.log" &
else
  opentest session create --template "${TESTENV}" --wait --out "${TESTREPORT}"
fi

while [ ! -f "${TESTREPORT}" ]; do
  echo -e "Wating test finishes and the report ${TESTREPORT}"
  sleep 5
done

cat "${TESTREPORT}"